{% load i18n %}
<div class="section section-data">
  {% if emergency_list and emergency_list|length %}
    <!-- Preferred: flat emergency list from schema -->
    <div class="card">
      <div style="overflow-x:auto;-webkit-overflow-scrolling:touch;">
      <table class="table-slim" role="presentation" style="width:100%;display:table;table-layout:fixed;border-collapse:collapse;">
        <thead>
          <tr>
            <th scope="col">{% trans 'Item' %}</th>
            <th scope="col">{% trans 'Qty' %}</th>
            <th scope="col">{% trans 'Unit' %}</th>
            <th scope="col">{% trans 'Notes' %}</th>
          </tr>
        </thead>
        <tbody>
        {% for it in emergency_list %}
          <tr {% if forloop.counter0|divisibleby:2 %}style="background:#fafafa;"{% endif %}>
            <td>{{ it.item_name }}</td>
            <td style="text-align:left;">{% if it.quantity_to_buy %}{{ it.quantity_to_buy }}{% else %}—{% endif %}</td>
            <td style="text-align:left;">{% if it.unit %}{{ it.unit }}{% else %}—{% endif %}</td>
            <td style="text-align:left;">{% if it.notes %}{{ it.notes|truncatechars:64 }}{% else %}—{% endif %}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    </div>
  {% elif supplies_by_category %}
    {% for tbl in supplies_by_category %}
      <div class="category" style="margin-bottom:12px;">
        <h3>{{ tbl.category }}</h3>
        <div style="overflow-x:auto;-webkit-overflow-scrolling:touch;">
        <table class="table-slim" role="presentation" style="width:100%;display:table;table-layout:fixed;border-collapse:collapse;">
          <thead>
            <tr>
              <th scope="col">{% trans 'Item' %}</th>
              <th scope="col">{% trans 'Qty' %}</th>
              <th scope="col">{% trans 'Unit' %}</th>
              <th scope="col">{% trans 'Notes' %}</th>
            </tr>
          </thead>
          <tbody>
          {% for it in tbl.items %}
            <tr {% if forloop.counter0|divisibleby:2 %}style="background:#fafafa;"{% endif %}>
              <td>{{ it.ingredient }}</td>
              <td style="text-align:left;">{% if it.quantity %}{{ it.quantity }}{% else %}—{% endif %}</td>
              <td style="text-align:left;">{% if it.unit %}{{ it.unit }}{% else %}—{% endif %}</td>
              <td style="text-align:left;">{% if it.notes %}{{ it.notes|truncatechars:64 }}{% else %}—{% endif %}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="card">
      <p>{% trans "No additional emergency supplies identified at this time." %}</p>
    </div>
  {% endif %}
  {{ content_html|safe }}
</div>
